
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>USTC评课社区</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/static/css/style.css" rel="stylesheet">

    {% block head %}
    {% endblock %}
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>




  <body>

    <nav class="navbar navbar-default">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="{{ url_for('home.index') }}">USTC评课社区</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li style="display: none"><a href="{{ url_for('home.index') }}">Home</a></li>
            <li style="display: none" class="active"><a href="{{ url_for('course.index') }}">Course</a></li>
            <li style="display: none"><a href="#">Forum</a></li>
          </ul>

          
          <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input type="text" name="q" class="form-control" id="search" placeholder="搜索课程名称、课堂号" style="width: 275px">
            </div>
            <button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-search grey"></span></button>
          </form>

          
          <ul class="nav navbar-nav navbar-right">
            {% if current_user.is_authenticated() %}
            <li><a href="#" style="display: none">Notice</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">{{ current_user.username }}<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="{{ url_for('user.view_profile', user_id=current_user.id) }}"">Profile</a></li>
                <li><a href="{{ url_for('user.account_settings', user_id=current_user.id) }}"">Settings</a></li>
                <li class="divider"></li>
                <li><a href="{{ url_for('home.logout') }}">Log out</a></li>
              </ul>
            </li>
            {% else %}
            <li><button type="button" class="btn btn-default navbar-btn left-mg-md" data-toggle="modal" data-target="#signin">登录</button></li>

            <div class="modal fade" id="signin" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-signin">
                <div class="modal-content">
                  <form id="signin-form" class="form-signin">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <div class="form-signin-heading">
                      <span class="h2">Please sign in</span>
                      <a class="btn btn-default float-right" href="/signup">Sign Up</a>
                    </div>
                    <div id="signin-alert" role="alert" class="display: none"></div>
                    <label for="inputEmail" class="sr-only">Username</label>
                    <input type="text" name="username" id="inputEmail" class="form-control" placeholder="Email or username" required autofocus>
                    <label for="inputPassword" class="sr-only">Password</label>
                    <input type="password" name="password" id="inputPassword" class="form-control" placeholder="Password" required>
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" name="remember" value="remember-me"> Remember me
                      </label>
                      <a class="float-right" href="/reset-password">Forgot Password</a>
                    </div>
                    <button class="btn btn-lg btn-blue btn-block" type="submit">Sign in</button>
                  </form>

                </div>
              </div>
            </div>

            {% endif %}
          </ul>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    {% block content %}
    {% endblock %}

    <footer class="footer">
      <div class="container">
        <div class="solid ud-pd-sm">
          <a class="right-pd-md" href='/about/'>About</a>
          <a class="right-pd-md" href='/blog/' style="display: none">Blog</a>
          <a class="right-pd-md" href='/report-bug/'>Report Bug</a>
        </div>
        <p class="footer-text text-muted">Copyright &copy; USTC评课社区 2015</p>
      </div>
    </footer>






    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script>
     $('#signin').on('shown.bs.modal', function () {
       $('#inputEmail').focus()
     });

     function signin_alert(msg, type) {
       if (!type)
         type = "danger";
       $('#signin-alert').attr("class", "alert alert-" + type);
       $('#signin-alert').html(msg);
       $('#signin-alert').show();
     }

     $('#signin-form').submit(function(e) {
       e.preventDefault();
       var formdata = {}
       $('#signin-form input').each(function() {
         formdata[$(this).attr("name")] = $(this).val();
       });
       $.ajax({
         type: "POST",
         url: "{{ url_for('home.signin', next=request.path, ajax=True) | safe }}",
         data: formdata,
         dataType: "json",
         success: function(res) {
            if (res.status == 200) {
                if (res.next)
                    window.location.href = res.next;
                else
                    signin_alert(res.msg, "success");
            } else {
                signin_alert(res.msg);
            }
         },
         error: function(e) {
            signin_alert('Oops! 服务器正在睡觉，请稍后再试。', "warning");
         }
       })
     });
    </script>

    {% block script %}
    {% endblock %}
  </body>
</html>
