{% extends "layout.html" %}
{% block content %}

<div class="container">
  <div class="float-element">
    <div class="inline-h3">
    <span class="blue h4">{% if not is_new %}编辑{% endif %}点评 &bull; {{ course.name }}（{{ course.teacher.name }}）</span>
    <span class="small grey align-bottom left-pd-sm desktop">学期：{{ course.term_display }} &nbsp;课堂号：{{ course.cno }}</span>
    <br><span class="small grey align-bottom mobile">学期：{{ course.term_display }} &nbsp;课堂号：{{ course.cno }}</span>
    </div>
    <hr>
    {% if message != '' %}
    <div class="alert alert-danger">{{ message }}</div>
    {% endif %}
    <form id="review-form" class="form-horizontal" method="post" action="{{ url_for('course.new_review', course_id=course.id) }}">
      {{ form.csrf_token }}
      <div class="rate-part ud-pd-md">
        {% for poll in polls %}
        <div class="ud-pd-sm">
          <span class="right-pd-sm weight-heavy">{{ poll['display'] }}</span>
          <div class="btn-group btn-group-inv" data-toggle="buttons">
            {% for option in poll['options'] %}
            <label class="btn btn-flat btn-grey rl-mg-sm {% if review[poll['name']] == loop.index %}active{% endif %}">
                <input type="radio" name="{{ poll['name'] }}" autocomplete="off" value="{{ loop.index }}" {% if review[poll['name']] == loop.index %}checked{% endif %}>
                {{ option }}
            </label>
            {% endfor %}
          </div>
        </div>
        {% endfor %}

        <link rel="stylesheet" href="/static/css/star-rating.min.css" media="all" rel="stylesheet" type="text/css">
        <div class="ud-pd-sm">
          <span class="weight-heavy pull-left">评个分吧？</span>
          <input id="rate-star" name="rate" value="{{ review.rate / 2.0 if review.rate else 4 }}">
          <span class="clearfix"></span>
        </div>
      </div>

      <div class="container-md desktop">
        <h4 class="grey">说几句吧！</h4>
        <div class="ud-pd-sm">
          <textarea id="content-editor" name="content">{{ review.content|safe }}</textarea>
        </div>
        <button type="submit" class="btn btn-blue btn-flat float-right shadow">发布</button>
        <div class="ud-pd-lg"></div>
      </div>

      <div class="container mobile">
        <h4 class="grey">说几句吧！</h4>
        <div class="ud-pd-sm">
          <textarea type="text" class="form-control" rows="8" id="inputDescription"></textarea>
        </div>
        <button type="submit" class="btn btn-blue float-right">发布</button>
        <div class="ud-pd-lg"></div>
      </div>


    </form>
  </div>
</div>
{% endblock %}

{% block script %}
<script src="/static/js/star-rating.min.js" type="text/javascript"></script>
<script>
$('#rate-star').rating({
    min: 0,
    max: 5,
    step: 0.5,
    size: "xs",
    showClear: false,
    glyphicon: false,
    ratingClass: 'glyphicon glyphicon-star',
    starCaptions: function(val) {
        return val*2;
    },
    starCaptionClasses: function(val) {
        return "blue";
    },
});

$(function(){
    $('#review-form').submit(function(e) {
            if ($('input[name=difficulty]:radio:checked').length == 0) {
                e.preventDefault();
                alert('请选择课程难度！');
                return;
            }
            if ($('input[name=homework]:radio:checked').length == 0) {
                e.preventDefault();
                alert('请选择作业多少！');
                return;
            }
            if ($('input[name=grading]:radio:checked').length == 0) {
                e.preventDefault();
                alert('请选择给分好坏！');
                return;
            }
            if ($('input[name=gain]:radio:checked').length == 0) {
                e.preventDefault();
                alert('请选择收获多少！');
                return;
            }
            if ($('textarea[name=content]').val().trim().length < 10) {
                e.preventDefault();
                alert('点评内容太短啦！');
                return;
            }
            $('input[name=rate]').val(Math.round($('input[name=rate]').val() * 2));
    });
});
</script>
{% include 'ckeditor.html' %}
{% endblock %}
